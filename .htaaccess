# Jay's Mobile Wash - Apache Configuration
# Version: 1.0
# Last Updated: 2025-06-25

# Enable Rewrite Engine
RewriteEngine On

# Set the base
RewriteBase /

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirect www to non-www
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301]

# Custom error pages
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# Browser caching
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Images
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  
  # CSS, JavaScript
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  
  # Others
  ExpiresByType application/pdf "access plus 1 month"
  ExpiresByType application/x-shockwave-flash "access plus 1 month"
</IfModule>

# Compress files
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
</IfModule>

# Prevent viewing of .htaccess file
<Files .htaccess>
  Order allow,deny
  Deny from all
</Files>

# Prevent directory browsing
Options -Indexes

# Canonical URL redirects for SEO
# Redirect for LA service area
RewriteRule ^los-angeles-mobile-car-wash$ /mobile-car-washing-los-angeles/ [R=301,L]
RewriteRule ^la-mobile-car-wash$ /mobile-car-washing-los-angeles/ [R=301,L]
RewriteRule ^la-mobile-detailing$ /mobile-car-washing-los-angeles/ [R=301,L]

# Redirect for OC service area
RewriteRule ^orange-county-car-wash$ /orange-county-mobile-car-wash/ [R=301,L]
RewriteRule ^oc-mobile-car-wash$ /orange-county-mobile-car-wash/ [R=301,L]
RewriteRule ^oc-mobile-detailing$ /orange-county-mobile-car-wash/ [R=301,L]

# Set security headers
<IfModule mod_headers.c>
  # Protect against XSS attacks
  Header set X-XSS-Protection "1; mode=block"
  
  # Prevent MIME-type sniffing
  Header set X-Content-Type-Options "nosniff"
  
  # Referrer policy
  Header set Referrer-Policy "no-referrer-when-downgrade"
</IfModule>

# Custom rewrites for voice search optimization
RewriteRule ^(mobile-car-wash-near-me)/?$ /?voice-search=true [L]
RewriteRule ^(mobile-detailing-near-me)/?$ /?voice-search=true [L]
RewriteRule ^(car-washing-service-near-me)/?$ /?voice-search=true [L]

# Cache busting
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+)\.([0-9]+)\.(js|css|png|jpe?g|gif|webp)$ $1.$3 [L]